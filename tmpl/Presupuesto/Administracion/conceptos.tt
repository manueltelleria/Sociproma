<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>[% titulo %]</title>
<!-- hojas de estilo generales -->
[% INCLUDE estilosgenerales.tt %]

<!-- archivos de javascript para Prototype -->
<script type="text/javascript" src="[%ruta_estatica%]/js/prototype/prototype.js"></script>

<!-- archivos de javascript para Seleccionar Item en las Listas -->
<script type="text/javascript" src="[%ruta_estatica%]/js/seleccionarItemList.js"></script>

<!-- archivos de javascript generales (cargar en todas las pÃ¡ginas) -->
[% INCLUDE jsgenerales.tt %]

[% formbuilder.jshead %]

<script type="text/javascript">
  
function cargarComboPartida(campoLlenar){
  var forma = document.conceptos;
        
  var texto = document.getElementById('criterio').value;
  var funcion = eval('llenar_' + campoLlenar);
  var url = '[% ruta_combo_partida %]';

  if (texto) {
    var pars = "criterio="+texto;
    var myAjax = new Ajax.Request( url, { method: 'post', parameters: pars , onComplete: funcion});
  }
  else {
    limpiarListas(campoLlenar);
  }
}

function llenar_id_partidas(originalRequest) {
  llenarListaDependiente(originalRequest, 'id_partidas');
}

function llenarListaDependiente(originalRequest, nombreListaLlenar) {
  var respuesta = originalRequest.responseText;
  var forma = document.conceptos;
  var listaLlenar = eval('forma.'+nombreListaLlenar);

  limpiarListas(nombreListaLlenar);

  if ( respuesta != 'undef' ){
    var primerarreglo = respuesta.split("|");
    for(i=0;i<primerarreglo.length;i++){
      var elemento  = primerarreglo[i].split(":");
      agregarOpcionLista(listaLlenar,new Option(elemento[1],elemento[0]));
    }
  }
}

function runMode( accion, id ){

  if ( accion == "generar" ){
    document.conceptos.action = "/presupuesto/formulacion/generaregresos/generarEgresos";
    document.conceptos.flag.value = 0;
    document.conceptos.submit();
  }

  if ( accion == "editar" ){
    document.conceptos.id_concepto.value = id;
    document.conceptos.action = "/presupuesto/administracion/conceptos/index";
    document.conceptos.flag.value = 0;
    document.conceptos.submit();
  }

  if ( accion == "eliminar" ){
    document.conceptos.id_concepto.value = id;
    document.conceptos.action = "/presupuesto/administracion/conceptos/eliminarConcepto";
    document.conceptos.submit();
  }

  if ( accion == "buscar" ){
    document.conceptos.action = "/presupuesto/administracion/conceptos/buscar";
    document.conceptos.submit();
  }

  if ( accion == "enviar"){
    document.conceptos.flag.value = 1; 
    document.conceptos.action = "/presupuesto/administracion/conceptos/index";
    if (validate_conceptos( document.conceptos)) { document.conceptos.submit(); } 
  }

  document.conceptos.submit();
}

// Función limpiarListas: Método encargado de limpiar el contenido de una lista desplegable.
function limpiarListas(nombreLista) {
  var forma = document.conceptos;
  vaciarLista(eval('forma.'+nombreLista));
}

function paginar( page ){
  document.conceptos.page.value = page;
  document.conceptos.submit();
}


</script>
</head>
<body  onload="cargarMenu()">
[% INCLUDE encabezado.tt %]
<fieldset>
<legend>Administrar Conceptos RRHH</legend>
<!-- Login form -->
[% formbuilder.start %]
[% formbuilder.statetags %]
[% formbuilder.keepextras %]
[% INCLUDE jscargarmenu.tt %]
<table align="center" border="0" cellspacing="1" cellpadding="2">
  <tr>
    <td align="left" class="fondoetiqueta" nowrap>[% formbuilder.field.snombre.label %]</td>
    <td>[% formbuilder.field.snombre.field %] (*)</td>
  </tr>
  <tr>
    <td align="left" class="fondoetiqueta" nowrap>[% formbuilder.field.sabreviatura.label %]</td>
    <td>[% formbuilder.field.sabreviatura.field %] (*)</td>
  </tr>
  <tr>
    <td align="left" class="fondoetiqueta" nowrap>[% formbuilder.field.id_tpnomina.label %]</td>
    <td>[% formbuilder.field.id_tpnomina.field %] (*)</td>
  </tr>
  <tr>
    <td align="left" class="fondoetiqueta" nowrap>[% formbuilder.field.id_partidas.label %]</td>
    <td><input autocomplete="off" id="criterio" name="criterio" onKeyUp="cargarComboPartida('id_partidas')" size="15" type="text" />&nbsp;[% formbuilder.field.id_partidas.field %] (*)</td>
  </tr>
  <tr>
    <td align="left" class="fondoetiqueta" nowrap>[% formbuilder.field.snombrefuncion.label %]</td>
    <td>[% formbuilder.field.snombrefuncion.field %] (*)</td>
  </tr>
  <tr>
    <td colspan="2" align="left">[% formbuilder.field.btnBuscar.field %]</td>
  </tr>
  <tr>
   <td colspan="2" align="left" ><font color="#0F305A" size="0" >Nota: (*) Estos campos son obligatorios.</font></td>
  </tr>
  <tr>
    <td colspan="2" align="center">[% formbuilder.field.btnEnviar.field %]</td>
  </tr>
</table>
<table align="center" border="0" cellspacing="1" cellpadding="2">
  <tr class=titulodonforojo>
    <th colspan=12>Conceptos</th>
  </tr>
  <tr class=fondoetiqueta5>
    <th >Abreviatura</th>
    <th >Nombre</th>
    <th >Partida Presupuestaria</th>
    <th >Nombre Función</th>
    <th >Aplica</th>
    <th >&nbsp;</th>
    <th >&nbsp;</th>
  </tr>
  [% FOREACH field IN tabla %]
    <tr class="[% field.clase %]">
      <td align="left">[% field.sabreviatura %]</td>
      <td align="left">[% field.snombre %]</td>
      <td align="left">[% field.id_partidas %]</td>
      <td align="left">[% field.snombrefuncion %]</td>
      <td align="left">[% field.id_tpnomina %]</td>
      <td align="center"><a href="#" onClick="javascript: runMode('editar', [% field.id %])"><img width="20" height="20" src="[% field.ruta_static %]/imagenes/bad.png" border="0" ></a></td>
      <td align="center"><a href="#" onClick="javascript: runMode('eliminar', [% field.id %])"><img width="20" height="20" src="[% field.ruta_static %]/imagenes/del.png" border="0" ></a></td>
    </tr>
  [% END %]
</table>
<br/>
[% IF tabla and last_page > 1 %]
<br>
<table align="center" width="30%">
  <tr>
    <td width="45%">
      <a style="text-decoration:none" href="javascript:paginar([% previous_page %])"><< Anterior</a>
    </td>
    <td width="10%" align="center">
      [% current_page %] / [% last_page %]
    </td>
    <td width="45%" align="right">
      <a style="text-decoration:none" href="javascript:paginar([% next_page %])">Siguiente >></a>
    </td>
  </tr>
</table>
[% END %]
[% formbuilder.field.id_concepto.field %]
[% formbuilder.field.flag.field %]
[% formbuilder.field.page.field %]
[% formbuilder.end %]
</fieldset>
</body>
</html>
