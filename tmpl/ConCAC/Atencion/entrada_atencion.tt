<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>[% titulo %]</title>
<!-- hojas de estilo generales -->
[% INCLUDE estilosgenerales.tt %]

<!-- archivos de javascript para Prototype -->
<script type="text/javascript" src="[%ruta_estatica%]/js/prototype/prototype.js"></script>

<!-- archivos de javascript para Seleccionar Item en las Listas -->
<script type="text/javascript" src="[%ruta_estatica%]/js/seleccionarItemList.js"></script>

<!-- archivos de javascript generales (cargar en todas las páginas) -->
[% INCLUDE jsgenerales.tt %]

<!-- hoja de estilo del calendario -->
<link rel="stylesheet" type="text/css" media="all" href="[% ruta_estatica %]/js/jscalendar/calendar-win2k-cold-2.css" title="Calendario" />
<script type="text/javascript" src="[% ruta_estatica %]/js/jscalendar/calendar.js"></script>
<script type="text/javascript" src="[% ruta_estatica %]/js/jscalendar/lang/calendar-es.js"></script>
<script type="text/javascript" src="[% ruta_estatica %]/js/jscalendar/calendar-setup.js"></script>

[% formbuilder.jshead %]


<script type="text/javascript">

    function upd(valor, ruta){
        document.forma.id_ciudadanos.value = valor;
        document.forma.action = ruta;
        document.forma.submit();
    }
    function upd2(valor, ruta){
        document.forma.id_casos.value = valor;
        document.forma.action = ruta;
        document.forma.submit();
    }
</script>

<script language="JavaScript">


function marcar() {
  document.forma.marca.value = 1;
}

// function calcular_edad(Fecha){
// 
// fecha = new Date(Fecha)
// hoy = new Date()
// ed = parseInt((hoy -fecha)/365/24/60/60/1000)
// alert(ed)
// // document.getElementById('pepe').value = "tienes " + ed + " años"
// 
// }

function calcular_edad(fecha){

    //calculo la fecha de hoy
    hoy= new Date()
    //alert(hoy)
    //alert(fecha)

    //calculo la fecha que recibo
    //La descompongo en un array
    var array_fecha = fecha.split("/")
    //si el array no tiene tres partes, la fecha es incorrecta
    if (array_fecha.length!=3)
       {alert('FORMATO INVALIDO');return false}

    //compruebo que los ano, mes, dia son correctos
    var ano
    ano = parseInt(array_fecha[2]);

    if (isNaN(ano))
       {alert('AÑO INVALIDO');return false}

    var mes
    mes = parseInt(array_fecha[1]);
    if (isNaN(mes))
       {alert('MES INVALIDO');return false}

    var dia
    dia = parseInt(array_fecha[0]);
    if (isNaN(dia))
       {alert('DIA INVALIDO');return false}


    //si el año de la fecha que recibo solo tiene 2 cifras hay que cambiarlo a 4
    if (ano <= 99){ 
      ano += 1900 
    }

   // edad = parseInt(hoy.getYear()) - parseInt(ano) + parseInt(1899); //-1 porque no se si ha cumplido años ya este año
    edad = parseInt(hoy.getFullYear()) - parseInt(ano);
     
    //si resto los meses y me da menor que 0 entonces no ha cumplido años. Si da mayor si ha cumplido
    if (parseInt(hoy.getMonth() + 1) - parseInt(mes) < 0){ //+ 1 porque los meses empiezan en 0
      //alert('1 Edad: '+edad);
      document.getElementById('nombreFuncionario').innerHTML =  edad
    //  return
    }

    if ( parseInt(hoy.getMonth() + 1) - parseInt(mes) > 0)
       {
     //    alert('2 Edad: '+edad);
        document.getElementById('nombreFuncionario').innerHTML =  edad+1
    //    return
        }
    //entonces es que eran iguales. miro los dias
    //si resto los dias y me da menor que 0 entonces no ha cumplido años. Si da mayor o igual si ha cumplido

   //if ( parseInt(hoy.getUTCDate() - dia) >= 0)
   //    {
   //      alert('3 Edad: '+edad);
   //     document.getElementById('nombreFuncionario').innerHTML =  edad +1
   //     return
   //     }

    // alert('4 Edad: '+edad);
    document.getElementById('nombreFuncionario').innerHTML  =  edad
    return
} 
</script>
</head>
<body onload="cargarMenu()">

[% INCLUDE encabezado.tt %]
<fieldset>
<legend>Datos Ciudadano (NATURAL)</legend>

[% formbuilder.start %]
[% formbuilder.statetags %]
[% formbuilder.keepextras %]
[% INCLUDE jscargarmenu.tt %]
<table align="center" width="65%">
  <tr>
    <td align="center" colspan="2" class="titulodonforojo">Datos Ciudadano (NATURAL)</td>
  </tr>
  <tr>
    <td align="left" class="fondoetiqueta" nowrap><b>[% formbuilder.field.scedularif.label %]</b></td>
    <td align="left">[% formbuilder.field.id_tprif.field %][% formbuilder.field.scedularif.field %]<b>[% id_tprif_lb %]-[% scedularif_lb %]</b></td>
  </tr>
<!--  <tr>
    <td align="left" class="fondoetiqueta" nowrap><b>Registro en el SENIAT</b></td>
    <td align="left">[% nombseniat %]</td>
  </tr>-->
  <tr>
    <td align="left" class="fondoetiqueta" nowrap><b>[% formbuilder.field.snombre.label %]</b></td>
    <td align="left">[% formbuilder.field.snombre.field %](*) </td>
  </tr>
  <tr>
    <td align="left" class="fondoetiqueta" nowrap><b>[% formbuilder.field.sapellido.label %]</b></td>
    <td align="left">[% formbuilder.field.sapellido.field %](*)</td>
  </tr>

  
<tr>
    <td width="15%" align="left" class="fondoetiqueta" ><b>[% formbuilder.field.dnacimiento.label %]<b></td>
    <td width="75%" align="left" valign=center>[% formbuilder.field.dnacimiento.field %]&nbsp;<img src="[% ruta_estatica %]/imagenes/calendario.jpg" title="Desplegar Calendario" width="25" height="18" id="a_dfecha" style="cursor: pointer; border: 0px solid #0F305A;" onmouseover="this.style.background='#0F305A';" onMouseOut="this.style.background=''" onBlur =  "calcular_edad(document.forma.dnacimiento.value)"/> 
           <script type="text/javascript">
           Calendar.setup({
                         inputField     :    "dnacimiento",    // id of the input field
                         ifFormat       :    "%d/%m/%Y",     // format of the input field
                         button         :    "a_dfecha",  // trigger for the calendar (button ID)
                         align          :    "Tl",           // alignment (defaults to "Bl")
                         singleClick    :    true
           });                                        
           </script>
        (*) </td>
  </tr>

  <tr>
    <td align="left" class="fondoetiqueta" nowrap><b>Edad</b></td>
    <td align="left"><b><div id='nombreFuncionario'>[% edad %]</div></b></td>
  </tr>

  <tr>
    <td align="left" class="fondoetiqueta" nowrap><b>[% formbuilder.field.id_tpgenero.label %]</b></td>
    <td align="left">[% formbuilder.field.id_tpgenero.field %](*)</td>
  </tr>

  <tr>
    <td align="left" class="fondoetiqueta" nowrap><b>[% formbuilder.field.id_tpentfederal.label %]</b></td>
    <td align="left">[% formbuilder.field.id_tpentfederal.field %](*)</td>
  </tr>

  <tr>
    <td align="left" class="fondoetiqueta" nowrap><b>[% formbuilder.field.sdireccion.label %]</b></td>
    <td align="left">[% formbuilder.field.sdireccion.field %](*)</td>
  </tr>

  <tr>
    <td align="left" class="fondoetiqueta" nowrap><b>[% formbuilder.field.stelefono.label %]</b></td>
    <td align="left">[% formbuilder.field.stelefono.field %](*)</td>
  </tr>

  <tr>
    <td align="left" class="fondoetiqueta" nowrap><b>[% formbuilder.field.stelefono2.label %]</b></td>
    <td align="left">[% formbuilder.field.stelefono2.field %](*)</td>
  </tr>
  <tr>
    <td align="left" class="fondoetiqueta" nowrap><b>[% formbuilder.field.sobservacion.label %]</b></td>
    <td align="left">[% formbuilder.field.sobservacion.field %](*)</td>
  </tr>
  <tr>
    <td colspan="2" align="center"><!--[% formbuilder.submit %]-->&nbsp;<input type=button  onclick="javascript: if (validate_forma(document.forma)) upd([% IF formbuilder.field.id_ciudadanos.value %][% formbuilder.field.id_ciudadanos.value %][% ELSE %]0[% END %],'/concac/atencion/atencion/entradaAtencion')" value='Guardar'/>&nbsp; <input type=button  onclick="javascript: upd(0,'/concac/atencion/atencion/buscarCiudadano')" value='<< Regresar'/>&nbsp; [% IF formbuilder.field.id_ciudadanos.value != '' %]<input type=button  onclick="javascript: upd(document.forma.id_ciudadanos.value,'/concac/atencion/atencion/listarCasos')" value='Ver Caso(s) >>'/> <input type=button  onclick="javascript: upd(document.forma.id_ciudadanos.value,'/concac/atencion/atencion/entradaCaso')" value='Agregar Caso >>'/>[% END %]
  </td>
  </tr>
  <tr class=''>
    <td colspan=2 >(*) Campos son obligatorios</td>
  </tr>
</table>

[% INCLUDE ConCAC/Atencion/listar_c.tt %]
               <input type=hidden name=retorno value='/concac/atencion/atencion/entradaAtencion'>
[% formbuilder.field.flag.field %]
[% formbuilder.field.id_ciudadanos.field %]
[% formbuilder.end %]
</fieldset>
</body>
</html>

